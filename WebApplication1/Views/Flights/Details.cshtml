@model Flight

@{
    ViewData["Title"] = "Flight Details";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<div class="container py-4">
    <h1 class="mb-4 text-center">Flight Details</h1>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-6">
                    <strong>Flight Number:</strong> @Model.FlightNumber <br />
                    <strong>Airline:</strong> @Model.Airline <br />
                    <strong>Status:</strong> @Model.Status <br />
                    <strong>Type:</strong> @Model.Type <br />
                    <strong>Aircraft ID:</strong> @Model.Aircraft?.Id
                </div>
                <div class="col-md-6">
                    <strong>Departure Airport:</strong> @Model.DepartureAirport?.Name <br />
                    <strong>Arrival Airport:</strong> @Model.ArrivalAirport?.Name <br />
                    <strong>Departure Time:</strong> @Model.DepartureTime.ToString("g") <br />
                    <strong>Arrival Time:</strong> @Model.ArrivalTime.ToString("g") <br />
                    <strong>Logo:</strong><br />
                    @if (!string.IsNullOrEmpty(Model.AirlineLogoUrl))
                    {
                        <img src="@Model.AirlineLogoUrl" alt="Airline Logo" style="max-height: 50px;" />
                    }
                </div>
            </div>
        </div>
    </div>

    <h4 class="mb-3 text-center">Flight Route</h4>
    <div id="map" style="height: 400px; border-radius: 12px; overflow: hidden;" class="mb-4 shadow-sm"></div>

    <div class="text-center">
        <a class="btn btn-outline-primary me-2" asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
        <a class="btn btn-outline-secondary" asp-action="Index">Back to List</a>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const depLat = @ViewBag.DepartureLat ?? "null";
    const depLng = @ViewBag.DepartureLng ?? "null";
    const arrLat = @ViewBag.ArrivalLat ?? "null";
    const arrLng = @ViewBag.ArrivalLng ?? "null";

    if (depLat && depLng && arrLat && arrLng) {
        const map = L.map('map').setView([(depLat + arrLat) / 2, (depLng + arrLng) / 2], 3);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        const depMarker = L.marker([depLat, depLng]).addTo(map).bindPopup("Departure");
        const arrMarker = L.marker([arrLat, arrLng]).addTo(map).bindPopup("Arrival");

        const route = L.polyline([[depLat, depLng], [arrLat, arrLng]], {
            color: 'blue',
            weight: 4,
            opacity: 0.7,
            smoothFactor: 1
        }).addTo(map);

        map.fitBounds(route.getBounds());
    } else {
        document.getElementById("map").innerHTML = "<p class='text-danger text-center pt-5'>Unable to load map. Coordinates missing.</p>";
    }
</script>
